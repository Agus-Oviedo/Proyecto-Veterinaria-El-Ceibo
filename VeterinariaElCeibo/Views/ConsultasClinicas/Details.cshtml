@model VeterinariaElCeibo.Models.ConsultaClinica

@{
    ViewData["Title"] = "Detalle de consulta clínica";

    bool tieneInternacion = ViewBag.TieneInternacion != null && (bool)ViewBag.TieneInternacion;
}

<h1>Detalle de consulta clínica</h1>

<div class="mb-3">
    <h5>
        Mascota: <strong>@Model.Mascota?.NombreMascota</strong><br />
        Tutor: @Model.Mascota?.Cliente?.NombreCompleto
    </h5>
    <p class="mb-1">
        <strong>Fecha de consulta:</strong> @Model.FechaConsulta.ToString("dd/MM/yyyy")
    </p>
    <p class="mb-1">
        <strong>Veterinario:</strong>
        @if (Model.Veterinario != null)
        {
            @($"{Model.Veterinario.Nombre} {Model.Veterinario.Apellido}")
        }
        else
        {
            <span class="text-muted">No registrado</span>
        }
    </p>
    @if (Model.Turno != null)
    {
        <p class="mb-1">
            <strong>Turno asociado:</strong>
            @Model.Turno.FechaHora.ToString("dd/MM/yyyy HH:mm") -
            @Model.Turno.Motivo
        </p>
    }
</div>

<hr />

<div class="card border-0 shadow-sm mb-3">
    <div class="card-header bg-white border-0">
        <h5 class="mb-0">Resumen clínico</h5>
    </div>
    <div class="card-body p-0">
        <div class="table-responsive">
            <table class="table table-sm mb-0">
                <tbody>
                    <tr>
                        <th style="width: 220px;">Motivo de consulta</th>
                        <td>@Model.Motivo</td>
                    </tr>
                    <tr>
                        <th>Relato / Anamnesis</th>
                        <td>@Model.Anamnesis</td>
                    </tr>
                    <tr>
                        <th>Examen físico / Hallazgos</th>
                        <td>@Model.ExamenFisico</td>
                    </tr>
                    <tr>
                        <th>Peso (kg)</th>
                        <td>
                            @if (Model.PesoKg.HasValue)
                            {
                                @Model.PesoKg.Value.ToString("0.00") @:kg
                            }
                            else
                            {
                                <span class="text-muted">No registrado</span>
                            }
                        </td>
                    </tr>
                    <tr>
                        <th>Temperatura (°C)</th>
                        <td>
                            @if (Model.TemperaturaC.HasValue)
                            {
                                @Model.TemperaturaC.Value.ToString("0.0") @:°C
                            }
                            else
                            {
                                <span class="text-muted">No registrada</span>
                            }
                        </td>
                    </tr>
                    <tr>
                        <th>Diagnóstico</th>
                        <td>@Model.Diagnostico</td>
                    </tr>
                    <tr>
                        <th>Tratamiento / Medicación</th>
                        <td>@Model.Tratamiento</td>
                    </tr>
                    <tr>
                        <th>Indicaciones al tutor</th>
                        <td>@Model.Indicaciones</td>
                    </tr>
                    <tr>
                        <th>Próximo control</th>
                        <td>
                            @if (Model.ProximoControl.HasValue)
                            {
                                @Model.ProximoControl.Value.ToString("dd/MM/yyyy")
                            }
                            else
                            {
                                <span class="text-muted">No programado</span>
                            }
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>

<div class="mt-3 d-flex align-items-center">
    <a asp-action="Index"
       asp-route-mascotaId="@Model.MascotaId"
       class="ceibo-back-pill">
        <span class="ceibo-back-pill-icon">←</span>
        Volver a historia clínica
    </a>

    @if (tieneInternacion)
    {
        <!-- Ya existe internación para esta consulta: solo mostramos hoja -->
        <a asp-controller="Internaciones"
           asp-action="Hoja"
           asp-route-consultaId="@Model.Id"
           class="btn btn-warning ms-3">
            Hoja de internación
        </a>
    }
    else
    {
        <!-- No hay internación todavía: permitir iniciarla -->
        <form asp-controller="Internaciones"
              asp-action="Iniciar"
              method="post"
              class="d-inline ms-3"
              id="formIniciarInternacion">
            @Html.AntiForgeryToken()
            <input type="hidden" name="consultaId" value="@Model.Id" />

            <button type="submit" class="btn btn-warning">
                Iniciar internación
            </button>
        </form>
    }
</div>
